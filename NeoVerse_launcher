@echo off
chcp 65001 >nul
setlocal enabledelayedexpansion
title üá∫üá∏ USA Proxy Discord Launcher

:: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
net session >nul 2>&1
if %errorlevel% neq 0 (
    echo –ó–∞–ø—É—Å–∫ –æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞...
    powershell -Command "Start-Process '%~f0' -Verb runAs"
    exit /b
)

echo ============================================
echo 1. –ó–ê–ì–†–£–ó–ö–ê –°–ü–ò–°–ö–ê –ë–ï–°–ü–õ–ê–¢–ù–´–• USA –ü–†–û–ö–°–ò
echo ============================================
:: –°–∫–∞—á–∏–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö SOCKS4 –ø—Ä–æ–∫—Å–∏ –¥–ª—è –°–®–ê
:: –≠—Ç–æ—Ç URL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç API ProxyScrape –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ IP:PORT (–±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤)
powershell -Command "try { Invoke-WebRequest -Uri 'https://api.proxyscrape.com/?request=displayproxies&proxytype=socks4&country=US&timeout=10000' -OutFile 'usa_proxies.txt' } catch { '' | Out-File 'usa_proxies.txt' }"

if not exist usa_proxies.txt (
    echo ‚ùå –û—à–∏–±–∫–∞: —Ñ–∞–π–ª usa_proxies.txt –Ω–µ —Å–æ–∑–¥–∞–Ω!
    pause
    exit /b
)

:: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—É—Å—Ç –ª–∏ —Ñ–∞–π–ª
for %%x in (usa_proxies.txt) do if %%~zx==0 (
    echo ‚ö†Ô∏è –§–∞–π–ª usa_proxies.txt –ø—É—Å—Ç.
    pause
    exit /b
)

echo.
echo ============================================
echo 2. –ü–û–ò–°–ö –†–ê–ë–û–ß–ï–ì–û –ü–†–û–ö–°–ò –ò–ó –°–®–ê
echo ============================================
set FOUND=0
for /f "delims=" %%L in (usa_proxies.txt) do (
    rem –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ IP:PORT
    for /f "tokens=1,2 delims=:" %%A in ("%%L") do (
        set "IP=%%A"
        set "PORT=%%B"
        echo –¢–µ—Å—Ç–∏—Ä—É—é –ø—Ä–æ–∫—Å–∏: !IP!:!PORT!...
        powershell -Command "(New-Object Net.Sockets.TcpClient).Connect('!IP!', !PORT!)" 2>nul
        if !errorlevel! equ 0 (
            set FOUND=1
            set "PROXY_IP=!IP!"
            set "PROXY_PORT=!PORT!"
            echo ‚úÖ –†–∞–±–æ—á–∏–π –ø—Ä–æ–∫—Å–∏ –Ω–∞–π–¥–µ–Ω: !PROXY_IP!:!PROXY_PORT!
            goto :LAUNCH
        )
    )
)

:LAUNCH
if %FOUND% neq 1 (
    echo ‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —Ä–∞–±–æ—á–∏–π –ø—Ä–æ–∫—Å–∏ –∏–∑ –°–®–ê.
    pause
    exit /b
)

echo.
echo ============================================
echo 3. –ó–ê–ü–£–°–ö DISCORD –ß–ï–†–ï–ó –ü–†–û–ö–°–ò
echo ============================================
:: –ü—É—Ç—å –∫ Discord (–æ–±–Ω–æ–≤–∏—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç Discord)
set "DISCORD_PATH=%LOCALAPPDATA%\Discord\Update.exe"
if exist "%DISCORD_PATH%" (
    echo –ó–∞–ø—É—Å–∫–∞—é Discord —Å –ø—Ä–æ–∫—Å–∏ socks4://%PROXY_IP%:%PROXY_PORT%...
    start "" "%DISCORD_PATH%" --processStart Discord.exe --proxy-server="socks4://%PROXY_IP%:%PROXY_PORT%"
) else (
    echo ‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω Discord –ø–æ –ø—É—Ç–∏: %DISCORD_PATH%
)

echo.
echo –†–∞–±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ –ª—é–±—É—é –∫–ª–∞–≤–∏—à—É –¥–ª—è –≤—ã—Ö–æ–¥–∞...
pause
exit /b
